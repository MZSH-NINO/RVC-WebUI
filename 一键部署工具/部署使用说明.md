# RVC-WebUI 部署使用说明

## 🎯 一键部署（推荐小白用户）

### 快速开始

**双击运行**：`一键部署.bat`（交互式部署向导）

脚本会自动：
1. ✅ 引导您选择显卡类型（NVIDIA / AMD / CPU）
2. ✅ 检测您的系统环境（Conda）
3. ✅ 自动完成安装和配置
4. ✅ 下载必需的模型文件

**说明**：该脚本位于"一键部署工具"文件夹中

---

## 📋 部署流程详解

### 第一步：选择显卡类型

```
步骤 1/2: 选择您的显卡类型

  [1] NVIDIA 显卡 (推荐)
      - 优点：性能最强，CUDA 加速
      - 需要：NVIDIA 显卡驱动

  [2] AMD / Intel 显卡
      - 优点：支持 DirectML 加速
      - 说明：性能不如 NVIDIA

  [3] 仅使用 CPU
      - 说明：运行较慢，不推荐

  [0] 退出安装
```

**选择建议：**
- **NVIDIA 显卡用户** → 选择 `1`（性能最强）
- **AMD/Intel 显卡用户** → 选择 `2`（支持 DirectML）
- **无独立显卡** → 选择 `3`（CPU 模式，较慢）

**环境检测：**
- 选择后会检测 Conda 是否安装
- 如果未安装，会提示下载地址并返回选择界面

### 第二步：确认并安装

系统会显示检测到的配置：

```
步骤 2/2: 确认安装配置

  系统已自动检测您的配置：
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  环境类型：Conda
  设备类型：NVIDIA 显卡
  环境名称：RVC-WebUI
  PyTorch：  CUDA 版本
  性能：    ⚡ GPU 加速 (快速)
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  预计安装时间：10-30 分钟 (取决于网速)

  [1] 确认并开始安装
  [0] 返回上一步
```

确认后，脚本会自动完成：
- 创建 Python 3.10 虚拟环境
- 安装 PyTorch（CUDA / DirectML / CPU 版本）
- 安装项目依赖
- 下载 ffmpeg 和 ffprobe
- 下载预训练模型（约 2GB）

---

## 🚀 安装后的使用方法

### 一键启动（推荐）

```bash
# 双击运行项目根目录的"一键启动.bat"
# 脚本会自动激活环境并启动 WebUI
# 浏览器会在服务器就绪后自动打开
```

### 手动启动

```bash
# 1. 激活环境
conda activate RVC-WebUI

# 2. 启动 WebUI
python infer-web.py

# 3. 在浏览器访问
http://127.0.0.1:7865
```

---

## 🔧 系统要求

### 最低配置（CPU 模式）

- **CPU**：Intel i5 / AMD Ryzen 5 以上
- **内存**：8GB RAM
- **磁盘**：10GB 可用空间
- **网络**：稳定的互联网连接

### 推荐配置（GPU 模式）

- **CPU**：Intel i7 / AMD Ryzen 7 以上
- **GPU**：NVIDIA RTX 2060 (6GB 显存) 或更高
- **内存**：16GB RAM
- **磁盘**：20GB 可用空间
- **CUDA**：CUDA Toolkit 11.7+

### AMD/Intel 显卡配置

- **CPU**：Intel i7 / AMD Ryzen 7 以上
- **GPU**：AMD RX 5000 系列 / Intel Arc 系列
- **内存**：16GB RAM
- **磁盘**：20GB 可用空间
- **说明**：使用 DirectML 加速，性能可能不如 NVIDIA

---

## 📥 模型下载

### 自动下载（推荐）

部署脚本会自动下载以下文件：
1. **HuBERT 模型**（181MB）- 语音特征提取
2. **RMVPE 模型**（173MB）- 音高提取
3. **Pretrained 模型**（约 1.7GB）- 预训练模型
4. **ffmpeg/ffprobe** - 音频处理工具

### 手动下载（可选）

如果自动下载失败，可运行：

```bash
# 激活环境
conda activate RVC-WebUI

# 下载模型
python tools\download_models.py

# 下载 ffmpeg
python 一键部署工具\download_ffmpeg.py
```

或从 HuggingFace 下载：
- 模型地址：https://huggingface.co/lj1995/VoiceConversionWebUI

---

## ❓ 常见问题

### Q1: 提示"环境检测失败"

**原因：** 未安装 Conda

**解决方案：**
1. 下载并安装 Miniconda：https://docs.conda.io/en/latest/miniconda.html
2. 安装完成后重新运行脚本

---

### Q2: 依赖安装失败

**原因：** 网络问题或包冲突

**解决方案：**

```bash
# 激活环境
conda activate RVC-WebUI

# 降级 pip
python -m pip install "pip<24.1"

# 重新安装依赖
pip install -r requirements-dml.txt  # AMD/Intel 显卡
# 或
pip install -r requirements.txt      # NVIDIA 显卡/CPU
```

---

### Q3: 模型下载失败

**原因：** 网络问题或 HuggingFace 连接失败

**解决方案：**

**方案1：设置镜像**
```bash
set HF_ENDPOINT=https://hf-mirror.com
python tools\download_models.py
```

**方案2：手动下载**
1. 访问：https://huggingface.co/lj1995/VoiceConversionWebUI
2. 下载所有文件到对应目录：
   - `hubert_base.pt` → `assets/hubert/`
   - `rmvpe.pt` → `assets/rmvpe/`
   - `pretrained/*.pth` → `assets/pretrained/`
   - `ffmpeg.exe` 和 `ffprobe.exe` → 项目根目录

---

### Q4: 启动后提示端口被占用

**原因：** 端口 7865 已被其他程序使用

**解决方案：**

**方案1：关闭其他实例**
```bash
# 在任务管理器中结束 python.exe 进程
```

**方案2：修改端口**
- 编辑 `infer-web.py`，修改端口号

---

### Q5: AMD 显卡性能不如预期

**原因：** DirectML 加速性能不如 CUDA

**说明：**
- AMD/Intel 显卡使用 DirectML 加速
- 性能通常为 NVIDIA 显卡的 30-70%
- 推荐使用 NVIDIA 显卡获得最佳体验

**解决方案：**
- 确保已安装最新显卡驱动
- 关闭其他占用显存的程序
- 考虑升级到 NVIDIA 显卡

---

### Q6: CPU 模式运行很慢

**原因：** CPU 计算能力远低于 GPU

**性能对比：**
- **GPU (CUDA)**：1-3 秒生成 10 秒语音
- **GPU (DirectML)**：3-10 秒生成 10 秒语音
- **CPU**：30-120 秒生成 10 秒语音（慢 30-100 倍）

**解决方案：**
1. **耐心等待**：首次运行可能需要几分钟
2. **升级硬件**：购买独立显卡
3. **云端运行**：使用云端 GPU 服务

---

## 💡 使用技巧

### 1. 推荐训练数据

**数据要求：**
- **时长**：至少 10 分钟纯净人声
- **音质**：清晰无杂音，采样率 ≥16kHz
- **格式**：WAV / MP3 / M4A
- **内容**：单人说话或唱歌，无背景音乐

### 2. 性能优化

**NVIDIA 显卡用户：**
- 确保安装了 CUDA Toolkit
- 推荐使用 RTX 20/30/40 系列显卡

**AMD/Intel 显卡用户：**
- 更新到最新显卡驱动
- 关闭其他占用显存的程序

**CPU 用户：**
- 关闭其他程序释放内存
- 使用较短的音频片段

### 3. 常用功能

**训练模型：**
1. 准备训练数据（音频文件）
2. 在 WebUI 中选择"训练"标签页
3. 上传音频并设置参数
4. 开始训练（GPU 约 10-30 分钟）

**推理变声：**
1. 加载训练好的模型
2. 上传要转换的音频
3. 选择音高提取算法（推荐 RMVPE）
4. 点击"转换"生成结果

---

## 📊 显卡类型对比

| 特性 | NVIDIA | AMD/Intel | CPU |
|------|--------|-----------|-----|
| **推理速度** | ⚡⚡⚡⚡⚡ | ⚡⚡⚡ | ⚡ |
| **训练速度** | ⚡⚡⚡⚡⚡ | ⚡⚡⚡ | ⚡ |
| **稳定性** | 最高 | 高 | 最高 |
| **适合人群** | 推荐 | 备选 | 无 GPU 用户 |
| **性能对比** | 100% | 30-70% | 1-3% |

---

## 🗑️ 卸载方法

```bash
# 删除虚拟环境
conda env remove -n RVC-WebUI

# 删除项目文件夹
cd ..
rmdir /s /q RVC-WebUI
```

---

## 📧 技术支持

遇到问题？欢迎寻求帮助：

- **GitHub**：https://github.com/RVC-Project/Retrieval-based-Voice-Conversion-WebUI
- **常见问题**：查看项目 Wiki
- **问题反馈**：提交 GitHub Issue

---

## 📜 许可证

本项目遵循 MIT 许可协议。详见 `LICENSE` 文件。

---

**祝您使用愉快！🎉**
